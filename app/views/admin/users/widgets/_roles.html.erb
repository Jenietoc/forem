<header class="mb-4">
  <h2 class="crayons-subtitle-2 mb-1 flex items-center">
    <%= crayons_icon_tag(:badge, title: "Assigned roles", class: "mr-2") %>
    Assigned roles
  </h2>
  <p class="color-secondary">Assign roles to this member based on permissions. <a href="https://admin.forem.com/docs/forem-basics/user-roles" class="c-link c-link--branded">Learn more</a></p>
</header>
<% unless @user.roles.any? %>
  <div class="flex justify-between items-center">
    <p>No special roles assigned yet.</p>
    <button class="c-btn c-btn--secondary whitespace-nowrap" type="button" data-modal-trigger data-modal-title="Add role" data-modal-size="m" data-modal-content-selector="#add-role">Add role</button>
  </div>
<% else %>
  <ul class="flex flex-wrap gap-2">
    <% @user.roles.reject { |role| role.name == "tag_moderator" }.each do |role| %>
      <% if role.name == "banned" || role.name == "suspended" || role.name == "super_admin" || @user.id == current_user.id %>
        <li>
          <span class="c-pill c-pill--inactive c-pill--icon-left cursor-not-allowed fs-italic crayons-tooltip__activator">
            <%= crayons_icon_tag(:lock, class: "c-pill__icon", width: 18, height: 18) %>
            <% if role.resource_name %>
              <%= role.resource_name.to_s %>
            <% else %>
              <%= role_display_name(role) %>
            <% end %>
            <span data-testid="tooltip" class="crayons-tooltip__content fs-normal pointer-events-none">You can't remove this role...</span>
          </span>
        </li>
      <% else %>
        <li>
          <%= button_to url_for(action: :destroy, user_id: @user.id, role: role.name.to_sym, resource_type: role.resource_type), method: :delete, data: { confirm: "Are you sure?" }, class: "c-pill c-pill--icon-right",
                                                                                                                                 style: "--icon-right-color: var(--color-secondary); --icon-right-color-hover: var(--accent-danger);" do %>
            <% if role.resource_name %>
              <%= role.resource_name.to_s %>
            <% else %>
              <%= role_display_name(role) %>
            <% end %>
            <%= crayons_icon_tag(:x, class: "c-pill__icon", width: 18, height: 18) %>
          <% end %>
        </li>
      <% end %>
    <% end %>
    <li><button class="c-btn c-btn--secondary whitespace-nowrap" type="button" data-modal-trigger data-modal-title="Add role" data-modal-size="m" data-modal-content-selector="#add-role">Add role</button></li>
  </ul>
<% end %>

<div id="add-role" class="hidden">
  <%= form_for(@user, url: user_status_admin_user_path(@user), html: { class: "flex flex-col gap-4", id: nil }) do |f| %>
    <div class="crayons-field">
      <%= f.label "Role", class: "crayons-field__label" %>
      <% options = { "Base Roles" => Constants::Role::BASE_ROLES } %>
      <% options["Special Roles"] = Constants::Role::SPECIAL_ROLES if current_user.super_admin? %>
      <%= f.select(:user_status, grouped_options_for_select(options), { include_blank: true }, class: "crayons-select") %>
    </div>
    <div class="crayons-field">
      <%= f.label "Reason", class: "crayons-field__label" %>
      <%= f.text_area :note_for_current_role, required: true, class: "crayons-textfield", placeholder: "What's the reason for adding a role?" %>
    </div>
    <div>
      <%= f.button "Add", class: "c-btn c-btn--primary" %>
    </div>
  <% end %>
</div>
